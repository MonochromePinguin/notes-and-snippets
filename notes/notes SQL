â— (client MySQL ln2Comm) :
mysql -u <user> -p<MdP, sans espace avant> -h <host> -P <nÂ°Port>  <BdD>

â— le standard par dÃ©faut est de ne PAS stocker les chaÃ®nes en UTF8 :
il faut donc Ã  la crÃ©ation d'une

â— (sqlite) COMMANDES SPÃ‰CIFIQUES Ã€ L'INTERFACE EN LN-DE-COMM :
â€¢ EFFACER L'Ã‰CRAN :
	ctrl+L ...
â€¢ exÃ©cuter une commande du shell :
	.shell <commande>

â™¦(MySQL) commandes notables :
	mysql -u <userW> -p		â†’ le Â«-pÂ» sans param fait demander le MdP
	source	\.
â™¦(MySQL) changer le prompt :
	prompt <chaÃ®ne>,
	l'envVar $MYSQL_PS1,
	l'option --prompt="..."
	la configuration au sein d'un .cnf : prompt=

â™¦(MySQL sous Debian) fichiers de config :
MySQL lit tout les *.cnf sous /etc/mysql/ ;
/etc/mysql/my.cnf : pour la config personnalisÃ©e



â™¦(sqlite ?) formatage de la sortie de la commande SELECT :
Â 	.mode html|list|csv|column

Â 	.mode list â† .separator xxx (par ex : Â«\tÂ» ou Â«~Â» ...)
	.mode column â† .width [x1 x2 x3 ...] (largueur de chaque colonne possible ...)

â™¦(sqlite ?) affichage des noms de colonnes :
Â 	.headers [on|off]

â™¦(sqlite ?) redirection de la sortie vers un fichier :
Â 	.output <nomFichier>
 puis
	.output stdout
		pour rÃ©tablir sortie vers l'Ã©cran ...

â€¢Â table cotennant des champs ;
 enregistrements classÃ©s par Â«clÃ©sÂ» (l'Â«idÂ» est souvent la Â«clÃ© primaireÂ») ;
 chaque ligne est un Â«tupleÂ» ou un Â«enregistrementÂ» ;

â€¢ SQL / NoSQL :
_ SQL : pour donnÃ©es structurÃ©es. Les clÃ©s des enregistrements relient les
 diffÃ©rentes tables entre elles ; pas de redondance des donnÃ©es.
_ NoSQL : pour donnÃ©es brutes â€“ plus performant en lecture pour de gros volumes
 de donnÃ©es, mais plus lent en Ã©criture et en recherches sur les champs
 "secondaires" â†’ on y crÃ©Ã©e souvent plusieurs tables pour faciliter les
 difÃ©rentes recherches.

â— CLÃ‰ PRIMAIRE, CLÃ‰ SECONDAIRE, CLÃ‰ Ã‰TRANGÃˆRE :
â€¢ clÃ© primaire :
	PRI
Le champs (ou la combinaison de champs) permettant de rÃ©fÃ©rencer de maniÃ¨re
 non-ambigÃ¼e l'enregistrement
â€¢ clÃ© secondaire :
	SEC
Une clÃ© rÃ©fÃ©renÃ§ant un autre enregistrement de la mÃªme table
â€¢ clÃ© Ã©trangÃ¨re :
  MUL pour Â«MULtipleÂ», car plusieurs occurences d'une mÃªme valeur sont permises
Une clÃ© rÃ©fÃ©renÃ§ant un enregistrement d'une autre table



â— fonctions de traitement de texte :
	replace(ch,de,vers)
	ltrim(ch, Ã suppr), rtrim(ch, Ã suppr),
		ou [lr]trim(ch) qui s'occupe des blancs
	repeat(ch,nb)
	substring(ch,pos,nb), substring(ch,pos), ...
	upper(ch), lower(ch),
	...

â— Texte comportant un mot-clef, ou des opÃ©rateurs, des caractÃ¨res blanc,
 ponctuation, accents, ... :
â€¢ encadrÃ© par des apostrophes 'xxx' : c'est une chaÃ®ne litÃ©rale.
	une apostrophe au sein de la chaÃ®ne sera doublÃ©e :
		l'a	â†’	'l''a'
â€¢ encadrÃ© par des guillemets "xxx" : c'est un identifiant.
	de mÃªme, un guillemet dans la chaÃ®ne sera doublÃ©.
		a"b"	â†’	"a""b"""

â€¢(SQLite, Âµsoft â€“ NON STANDARD) par des crochets [xxx] : identifiant.
â€¢(SQLite, MySQL â€“ NON STANDARD) par des accents graves `xxx` : identifiant.
Sous MySQL, cette technique â†‘ est nÃ©cessaire pour tout caractÃ¨re non ASCII.

â€¢ (MySQL) limitations sur longueur et casse des identifiants :
_ La plupart des identifiants sont limitÃ©s Ã  64 caractÃ¨res (sauf alias,
 qui sont la plupart du temps Ã  256 cars).

_Chaque BdD est un sous-rÃ©pertoire du dossier de travail MySQL
 (/var/lib/mysql par dÃ©faut), et chaque table correspond Ã  au moins
 un fichier ...
â†’ en fonction des systÃ¨mes de fichier, les noms de tables et de BdD
 seront ou non sensibles Ã  la casse.

_ noms de colonnes, fonctions stockÃ©es, noms d'Ã©vÃ©nements sont
 insensibles Ã  la casse.


â— Â« SELECT LAST_INSERT_ID() Â» :
Renvoit le 1er id en auto-incrÃ©ment de la derniÃ¨re requÃªte INSERT ou UPDATE ...
Unique par connection â†’ pas de problÃ¨me de concurrence lors d'accÃ¨s parallÃ¨les !



â— COUNT([*|ALL|(DISTINCT)?expressionRenvoyantUneColonne]) :
Â  * :			les lignes,
  ALL :			ttes les valeurs (par dÃ©faut)
  expr :		une colonne ou qqch chose assimilable
  DISTINCT expr : les valeurs uniques de l'expression
â€¢ les FONCTIONS D'AGRÃ‰GATION COUNT(), SUM(), AVG(), ...
 peuvent fonctionner avec un Â« GROUP BY Â»


â— GROUP BY, ORDER BY sont cumulables :
p.ex	SELECT region, ville, COUNT(*) AS nbEleves FROM Ã©coles
		GROUP BY region
		GROUP BY ville
		HAVING nbEleves > 10
		ORDER BY region ASC
		ORDER BY ville ASC;


â— sous-requÃªtes : requÃªte entre parenthÃ¨ses !
Utilisables dans les clauses SELECT, FROM, WHERE.
p. ex :
	SELECT nom FROM gens WHERE adresse IN ( SELECT nom FROM villes
		WHERE population > 5000 );
ou
	SELECT nom FROM Ã Copier WHERE 1 = ALL(
		SELECT name FROM from pragma_table_info('Ã Copier')
			WHERE type="INTEGER" AND NOT name="typeCopie" );
â†’ renvoit les noms des enregistrements dont toutes les colonnes de type
 "ENTIER" (sauf typeCopie) valent 1.

â€¢(sqlite) sqlite n'a pas de ALL() !


â— VUES â‰  TABLE TEMPORAIRE :
	VUE : en lecture seule, stockÃ©e ds la BdD
	TABLE TEMPORAIRE : en L/E, stockÃ©e en mÃ©moire ...


â™¦ EXPRESSIONS RATIONNELLES dans le paramÃ¨tre de Â«LIKEÂ» :
les expressions rationnelles s'Ã©crivent entre guillements simples Â«'Â».
	   % remplace *,
	et _ remplace ?

â™¦ SELECT sert aussi Ã  afficher du texte brut.

â€¢ SELECT expression AS nouveauNom ...

â— clauses notables :
	ORDER BY "xxx" [ASC|DESC]	â† Â«ascendantÂ»/Â«descendantÂ»
	LIMIT ğ‘›						â†’ pas plus de ğ‘›  entrÃ©es renvoyÃ©es.


â— WHERE :
	BETWEEN
	IN
	LIKE
	=, <>, =>, <=, >, <
AND, OR, NOT



â— DISTINCT :
	SELECT DISTINCT(xxx) FROM yyy;


â— JOKERS :
	%	â†’ Ã©quivalent *
	_	â†’ Ã©quivalent ?


â— JOINTURE :
â€¢ jointure par dÃ©faut :
	SELECT * FROM Ã©lÃ¨ves, Ã©coles (...)
est Ã©quivalent Ã 
	SELECT * FROM Ã©lÃ¨ves JOIN Ã©coles (...)

â€¢ clause ON :
 pour ne pas mettre la condition d'Ã©galitÃ© de deux clÃ©s dans la clause WHERE.
â€¢ clause USING( xxx ) :
Quand le nom de colonne est le mÃªme dans les 2 tables, on peut s'en
 servir de raccourci pour
	ON ( tbl1.xxx = tbl2.xxx )

â€¢Â  SELECT h.prenom, h.nom,  s.nom,  r.date_et_heure, r.duree
	FROM reservations AS r
	JOIN salles AS s ON r.id_classe = s.id
	JOIN humains AS h ON h.id = r.id_reservant;

	SELECT * FROM Ã©lÃ¨ves JOIN Ã©coles ON Ã©lÃ¨ves.id_Ã©cole = Ã©coles.id
	  WHERE Ã©cole.nom = 'Bordeaux';
â€¢ elles sont imbricables :
rÃ©cupÃ¨re les noms d'Ã©lÃ¨ves apprenant le PHP,
 au sein d'une BdD contenant les tables Ã©leve â†’ Ã©cole â†’ language :
 	SELECT nom FROM Ã©lÃ¨ves
		JOIN Ã©cole ON Ã©lÃ¨ve.id_Ã©cole = Ã©cole.id
			JOIN language ON Ã©cole.id_lang = language.id
				WHERE language.nom = 'PHP';
â€¢ diffÃ©rents types :
[INNER|] JOIN	â†’ retourne les enregistrements pour lesquels la condition
 du ON est remplie dans les 2 tables droite et gauche
LEFT JOIN â†’	affiche aussi les enreg de la table de gauche ne remplissant
 pas la condÂ°
RIGHT JOIN â†’ affiche aussi les enreg de la tbl de droite ne remplissant pas ...


â— UNION :
	union de 2 requÃªtes, sans doublons.
â— UNION ALL :
	on laisse les doublons.


â— FONCTIONS :
	length()
	replace()
	substring()
	concat()
	...
â€¢ fonctions mathÃ©matiques :
	COS(), EXP(), LOG(), PI(), ...
â€¢ fonctions de gÃ©olocalisation,
â€¢ de date :
	NOW()	â†’ rv la date actuelle,
	YEAR(), MONTH(),
	DATEDIFF() â†’ diffÃ©rence entre 2 dates,

â€¢ fonctions travaillant sur des aggrÃ©gats :
	COUNT(), SUM(), MAX(), MIN(), AVG(), ...



â—(sqlite) Â« pragma table_info(tbl) Â» :
	renvoit une table listant les colonnes de Â«tblÂ» et leurs attributs :
		cid	/ name / type / notnull / dflt_value / pk

â—(sqlite) compter le nb de colonnes d'une table:
	SELECT COUNT(*) FROM pragma_table_info("nomTable");
Le nom de la table doit Ãªtre encadrÃ© de guillemets (simples ou doubles),
 car pragma_table_info() est une fÂ°.


â—SQLite understands the following binary operat	ors,
 in order from highest to lowest precedence:
 [sans oublier les parenthÃ¨ses ...] ( xxx )
    || (CONCATÃ‰NATION de chaines !)
    *    /    % (modulo)
    +    -
    <<   >>   &    |
    <    <=   >    >=
    =    ==   !=   <>   IS   IS NOT   IN   LIKE   GLOB   MATCH   REGEXP
    AND
    OR
Supported unary prefix operators are these:
    -    +    ~    NOT



â™¦des exemples que j'ai utilisÃ©s :
Â« SELECT filename, entry_title, releaseDateObj FROM item
	WHERE filename LIKE '%ITEMA%' AND feed_id = 7958 ORDER BY filename; Â»
Â« select entry_title from item where feed_id = (select ufeed_id from rss_feed_impl
	where title = 'Sur les Ã©paules de Darwin'); Â»



â— CRÃ‰ATION / SUPPRESSION D'UNE TABLE EN MySQL :
  CREATE TABLE <table>
  (
	id INT PRIMARY KEY AUTO_INCREMENT,
			â†’ clÃ© primaire numÃ©rique : plus rapide pour les recherches
	nom VARCHAR(tMax),
	date DATE,			â†’ au format AAAA/MM/JJ
	info	TEXT		â†’ texte de taille arbitraire
  );

La taille des champs doit Ãªtre bien pensÃ©e â€“ les champs consomment de la place.

  DROP TABLE <table>;
  DROP DATABASE <Bdd>;

â—(MySQL) COMMANDES ADMINISTRATIVES :
Â  CREATE USER [IF NOT EXIST] <user> IDENTIFIED BY 'MdP'...
	â†’ il y a de nbx options pour spÃ©cifier les droits, la frÃ©quence de renouvellement du MdP, ...
	 Penser Ã  NE JAMAIS UTILISER Â«rootÂ» en tant qu'utilisateur !
  DROP USER;
  SET PASSWORD [FOR <user>] = PASSWORD('MdP');

Â  SHOW GRANTS [FOR CURRENT_USER];

â€¢ octroi de droits aux utilisateurs :
Â  GRANT ...		â†’ gestion des droits d'accÃ¨s
				â†’ aussi pour lister les utilisateurs.
	GRANT SELECT, UPDATE ON [ <BdD> | <BdD>.<tbl> ] TO <user@hÃ´te>;

Les droits de crÃ©ation & suppression de table au sein d'une BdD sont allouÃ©s
 un-Ã -un :
Â 	GRANT CREATE ON <BdD>.* TO <user@hÃ´te>;
	GRANT DROP ON <BdD>.* TO <user@hÃ´te>;

â€¢ spÃ©cifier l'utilisateur :
	testeur@localhost
	'testeur'@'localhost';
	'user'@'192.13.25.45';
_ % : joker pour Â« toutes adresses IP Â» ;
	'user1'@'%';

Â  SHOW DATABASES;
  SHOW TABLES [ FROM <BdD> ];

Â  SHOW [FULL] COLUMNS FROM [<BdD>.]<table>;
	â†’ montre la structure logique de la table
Â  DESCRIBE <table>;			â†’ itou

Â  ALTER TABLE <table> [ ADD ... | DROP ... | MODIFY ... ];


â€¢(MySQL) EXPORTER UNE BdD :
	mysqldump -u <user> [-p|] --databases <BdD> > <fic.sql> #avec un Â«SÂ»
â€¢(MySQL) et l'importer :
	mysql -u <user> [-p|] --database <BdD> < <fic.sql>


â— rÃ©initialisation du MdP root :
_Â arrÃªter le service
_Â mysqld_safe --skip-grant-tables :
	redÃ©marrer le dÃ©mon en mode sÃ»r, SANS charger la table de droits
	â†’ AUCUN contrÃ´le d'accÃ¨s !
_ use mysql;
  UPDATE user SET password = PASSWORD(MdP) WHERE user = 'root';
	â†‘ ceci ne tient pas compte du nom d'hÃ´te ...
_ flush privileges;
_ redÃ©marrer mysql en mode normal

â— ENCODAGE DE CARACTÃˆRES (Â«CHARACTER SETÂ») ET ORDRE DE TRI (Â«COLLATEÂ») :
Â  SHOW CHARACTER SET [LIKE ...];
  SHOW COLLATION [LIKE ...];
â€¢ obtenir encodage et ordre de tri utilisÃ©s par une BdD :
	SELECT @@character_set_database, @@collation_database;
â€¢ modifier l'encodage d'une BdD ou d'une table :
	ALTER [TABLE|DATABASE] <id> CHARACTER SET utf8mb4
	  COLLATE utf8mb4_general_ci;



â— mÃ©tacommandes SQLite & Cie :
Â«.tablesÂ» == Â«SELECT name FROM sqlite_masterÂ» â†’ liste les tables prÃ©sentes

â”Œâ”€â”€ la mÃªme chose Ã  peu de choses prÃ¨s :
â”‚Â«.schema <nomTable>Â» â†’ liste commandes ayant crÃ©Ã© la table
â”‚Â«pragma table_info(<nomTable>)Â» â†’ affiche la structure d'une table
â””â”€â”€

.databases â†’ liste des BD ouvertes
